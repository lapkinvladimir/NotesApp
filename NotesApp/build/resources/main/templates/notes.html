<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Общие стили */
        body {
            margin: 0;
            padding: 0;
            position: relative;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-repeat: no-repeat;
            z-index: -1;
        }



        /* Адаптивные стили */
        .black-rectangle {
            width: 322px;
            height: 100vh;
            background-color: #282828;
            border-right: 2px solid white;
            position: absolute;
            top: 0;
            left: 0;
        }

        .logo-container {
            position: absolute;
            top: 40px;
            left: 42px;
            display: flex;
            align-items: center;
            cursor: pointer; /* Добавили курсор-указатель */
        }

        .logo {
            width: 40px;
            height: 40px;
            background-size: cover;
            border-radius: 50%;
            margin-right: 5px
        }

        .arrow {
            width: 15px;
            height: 15px;
            background-image: url('https://api.iconify.design/mingcute/down-line.svg');
            background-size: cover;
            margin-left: 5px;
            transition: transform 0.3s ease; /* Добавили плавную анимацию */
            filter: invert(1);
        }

        .settings-tab {
            max-width: 200px;
            display: none;
            position: absolute;
            top: 90px;
            right: 10px;
            background-color: #7a7a7a;
            padding: 10px;
            border-radius: 5px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .username {
            color: white;
            font-size: 16px;
            margin-left: 5px;
        }

        /* Добавили стили для кнопок во вкладке */
        .tab-button {
            margin-top: 10px;
            cursor: pointer;
            padding: 8px 12px;
            background-color: #f1f1f1;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .tab-button:hover {
            background-color: #adadad;
        }

        .big-settings-window {
            width: 1000px;
            height: 500px;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.5);;
            background-color: #7a7a7a;
            padding: 20px;
            border-radius: 5px;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            z-index: 1;
            transition: transform 0.3s ease;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
        }

        .background-image {
            width: 250px;
            height: 150px;
            border: 2px solid white; /* Добавили белую границу */
            cursor: pointer;
            margin: 10px;
            transition: border-color 0.3s ease;
        }

        .avatar-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 2px solid white; /* Добавили белую границу */
            cursor: pointer;
            margin: 10px;
            transition: border-color 0.3s ease;
        }

        .avatar-image:hover,
        .background-image:hover {
            border-color: #adadad; /* Изменяем цвет границы при наведении */
        }


        .backgrounds {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .avatars {
            display: flex; /* Добавили flex-контейнер */
            flex-wrap: nowrap; /* Запретили перенос элементов на новую строку */
            align-items: center; /* Выравнивание элементов по вертикали */
            overflow-x: auto; /* Горизонтальный скроллинг, если элементов много */
            padding-bottom: 10px; /* Добавили отступ снизу */
        }

        .avatar,
        .background {
            flex: 0 0 auto; /* Отключили увеличение элементов по ширине */
            margin-right: 10px; /* Добавили отступ между элементами */
        }


    </style>
    <title>Auth Page</title>
</head>
<body>
<div class="background-container" th:style="'background-image: url(' + ${selectedBackground} + ');'"></div>
<div class="black-rectangle"></div>
<div class="logo-container" onclick="toggleSettingsTab()">
    <img class="logo" th:style="'background-image: url(' + ${selectedAvatar} + ');'" onclick="handleLogoClick(event)">
    <div class="username" id="username" onclick="handleUsernameClick(event)"></div>
    <div class="arrow" id="arrow"></div>
</div>



<div class="settings-tab" id="settingsTab">
    <div class="tab-button">Profile</div>
    <div class="tab-button" onclick="openBigSettingsWindow()">Settings</div>
    <div class="tab-button" onclick="logout()">Logout</div>
</div>

<div class="big-settings-window" id="bigSettingsWindow">
    <span class="close-button" onclick="closeBigSettingsWindow()">&#10006;</span>
    <h2>Выберите себе аватарку</h2>
    <div class="avatars">
        <div class="avatar">
            <img src="/img/avatar.png" alt="Avatar 1" class="avatar-image" onclick="selectAvatar(this)">
        </div>
        <div class="avatar">
            <img src="/img/Avatar_Lin.png" alt="Avatar 2" class="avatar-image" onclick="selectAvatar(this)">
        </div>
    </div>
    <h2>Выберите задний фон</h2>
    <div class="backgrounds">
        <div class="background">
            <img src="/img/back.png" alt="Background 1" class="background-image" onclick="selectBackground(this)">
        </div>
        <div class="background">
            <img src="/img/back2.jpg" alt="Background 2" class="background-image" onclick="selectBackground(this)">
        </div>
        <!-- Добавьте остальные фоны здесь -->
    </div>


    <script>

        // Добавьте следующий код в конец вашего существующего скрипта
        // document.addEventListener("DOMContentLoaded", function () {
        //     fetch("/notes")
        //         .then(response => response.json())
        //         .then(userData => {
        //             const avatarImage = document.querySelector(".logo");
        //             avatarImage.style.backgroundImage = `url('${userData.selectedAvatar}')`;
        //
        //             const backgroundContainer = document.querySelector(".background-container");
        //             backgroundContainer.style.backgroundImage = `url('${userData.selectedBackground}')`;
        //         })
        //         .catch(error => {
        //             console.error("Error fetching user data:", error);
        //         });
        // }




        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        const username = getCookie("username");
        if (username) {
            document.getElementById("username").textContent = username;
        } else {
            document.getElementById("username").textContent = "Username: Guest";
        }

        const settingsTab = document.getElementById("settingsTab");
        const arrow = document.getElementById("arrow");

        // Переключение видимости вкладки и анимация стрелки
        function toggleSettingsTab() {
            if (settingsTab.style.opacity === "1") {
                settingsTab.style.opacity = "0";
                settingsTab.style.pointerEvents = "none"; // Делаем вкладку неактивной во время анимации скрытия
                arrow.style.transform = "rotate(0)";
            } else {
                settingsTab.style.display = "block"; // Показываем вкладку перед анимацией появления
                settingsTab.style.pointerEvents = "auto"; // Восстанавливаем активность вкладки
                settingsTab.style.opacity = "1";

                // Позиционируем вкладку прямо под стрелочкой
                const logoContainerRect = document.querySelector(".logo-container").getBoundingClientRect();
                settingsTab.style.left = logoContainerRect.left + "px";
                settingsTab.style.top = logoContainerRect.bottom + "px";

                arrow.style.transform = "rotate(180deg)";
            }
        }

        // Обработка клика по лого
        function handleLogoClick(event) {
            event.stopPropagation();
            toggleSettingsTab();
        }

        // Обработка клика по имени пользователя
        function handleUsernameClick(event) {
            event.stopPropagation();
            toggleSettingsTab();
        }

        function logout() {
            window.location.href = "/";
        }

        const bigSettingsWindow = document.getElementById("bigSettingsWindow");

        // Открытие большого окна настроек
        function openBigSettingsWindow() {
            closeSettingsTab(); // Закрыть маленькое окно настроек
            bigSettingsWindow.style.display = "block";
            arrow.style.transform = "rotate(0)"; // Перевернуть стрелочку обратно
            setTimeout(() => {
                bigSettingsWindow.style.transform = "translate(-50%, -50%) scale(1)";
            }, 0);
        }

        // Закрытие большого окна настроек
        function closeBigSettingsWindow() {
            bigSettingsWindow.style.transform = "translate(-50%, -50%) scale(0.5)";
            setTimeout(() => {
                bigSettingsWindow.style.display = "none";
            }, 300);
        }

        // Закрытие маленького окна настроек
        function closeSettingsTab() {
            settingsTab.style.opacity = "0";
            settingsTab.style.pointerEvents = "none";
        }



        function saveSelectedLogos(avatarUrl) {
            fetch("/notes", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    selectedAvatar: avatarUrl
                })
            })
                .then(response => response.json())
                .then(data => {
                    // Данные успешно сохранены
                })
                .catch(error => {
                    console.error("Error saving images:", error);
                });
        }

        function saveSelectedBackgrounds(backgroundUrl) {
            console.log("сейв вызывался")
            // Отправляем данные на сервер
            fetch("/notes", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    selectedBackground: backgroundUrl
                })
            })
                .then(response => response.json())
                .then(data => {
                    // Данные успешно сохранены
                })
                .catch(error => {
                    console.error("Error saving images:", error);
                });
            console.log("сейв законичлся")
        }

        function selectAvatar(element) {
            const selectedAvatar = element.src;
            const avatarImage = document.querySelector(".logo");
            avatarImage.style.backgroundImage = `url('${selectedAvatar}')`;
            console.log("ава поменялась на сайте")
            saveSelectedLogos(selectedAvatar, null); // Вызываем функцию для сохранения
            console.log("сейв прошел")
        }

        function selectBackground(element) {
            const selectedBackground = element.src;
            const backgroundContainer = document.querySelector(".background-container");
            backgroundContainer.style.backgroundImage = `url('${selectedBackground}')`;
            console.log("бг поменялся на сайте");
            saveSelectedBackgrounds(selectedBackground); // Вызываем функцию для сохранения
            console.log("сейв прошел");
        }






        // Закрываем вкладку при клике в любое место на экране
        window.addEventListener("click", function (event) {
            if (!settingsTab.contains(event.target) && !arrow.contains(event.target)) {
                settingsTab.style.opacity = "0";
                settingsTab.style.pointerEvents = "none"; // Делаем вкладку неактивной во время анимации скрытия
                arrow.style.transform = "rotate(0)";
            }
        });
    </script>
</body>
</html>
